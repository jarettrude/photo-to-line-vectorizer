#!/bin/bash
# Pre-commit hook that runs all checks

set -e

echo "ğŸ” Running pre-commit checks..."

# Backend checks
echo ""
echo "ğŸ“¦ Backend checks..."
echo "â†’ Ruff linting..."
cd backend && python -m ruff check app/ tests/ || { echo "âŒ Ruff linting failed"; exit 1; }

echo "â†’ Ruff formatting..."
python -m ruff format app/ tests/ --check || { echo "âŒ Ruff formatting failed"; exit 1; }

echo "â†’ MyPy type checking..."
python -m mypy app/ --strict --no-error-summary || { echo "âŒ MyPy type checking failed"; exit 1; }

echo "â†’ Running pytest..."
python -m pytest tests/ -v --tb=short || { echo "âŒ Pytest failed"; exit 1; }

cd ..

# Frontend checks
echo ""
echo "ğŸ¨ Frontend checks..."
echo "â†’ ESLint..."
cd frontend && npm run lint || { echo "âŒ ESLint failed"; exit 1; }

echo "â†’ Prettier..."
npm run format:check || { echo "âŒ Prettier check failed"; exit 1; }

echo "â†’ TypeScript type checking..."
npm run type-check || { echo "âŒ TypeScript check failed"; exit 1; }

echo "â†’ Building..."
npm run build || { echo "âŒ Build failed"; exit 1; }

cd ..

echo ""
echo "âœ… All checks passed! Ready to commit."
